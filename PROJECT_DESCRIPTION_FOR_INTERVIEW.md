# 云边奶茶铺 AI 智能助手系统 - 项目描述

## 项目概述

**项目名称**：云边奶茶铺 AI 智能助手系统  
**技术栈**：Python 3.8+、DashScope (通义千问)、Flask、Milvus Lite、SQLite/MySQL  
**项目类型**：多智能体系统 (Multi-Agent System)、RAG 检索增强生成、企业级 AI 应用

---

## 核心功能

### 1. 多智能体协同架构 (Multi-Agent System)

**架构模式**：Supervisor 模式（监督者模式）

- **SupervisorAgent（监督者智能体）**
  - 负责请求路由和智能体协调
  - 基于 LLM 的意图识别，自动判断用户需求类型
  - 支持动态服务发现，灵活扩展子智能体

- **OrderAgent（订单智能体）**
  - 处理订单相关业务：创建订单、查询订单、修改订单、删除订单
  - 支持订单参数提取（产品名称、甜度、冰量、数量等）
  - 集成数据库持久化，确保订单数据安全

- **ConsultAgent（咨询智能体）**
  - 处理产品咨询、活动信息、冲泡指导
  - 集成 RAG 检索增强生成，基于知识库回答专业问题
  - 支持向量相似度搜索，精准匹配用户问题

- **FeedbackAgent（反馈智能体）**
  - 处理用户反馈、投诉和差评
  - 支持情感分析和反馈分类

### 2. Agent-to-Agent (A2A) 通信协议

**自研协议**：基于 HTTP RESTful API 的智能体间通信协议

- **协议特点**：
  - 标准化的请求/响应格式
  - 支持同步和流式（SSE）两种调用方式
  - 完整的错误处理和超时机制
  - 服务发现机制，支持动态服务注册

- **技术实现**：
  - Flask 实现 HTTP 服务端
  - requests 实现 HTTP 客户端
  - JSON 格式数据交换
  - 支持 `user_id`、`chat_id` 等上下文传递

### 3. Model Context Protocol (MCP) 工具调用

**MCP 协议**：AI 智能体与业务工具的标准接口协议

- **OrderMCPServer（订单工具服务器）**
  - `order-create-order-with-user`: 创建订单
  - `order-get-order`: 根据订单ID查询订单
  - `order-get-orders-by-user`: 查询用户所有订单
  - `order-delete-order`: 删除订单
  - `order-update-remark`: 更新订单备注

- **ConsultMCPServer（咨询工具服务器）**
  - 集成 RAG 服务，提供知识库检索能力
  - 支持文档加载、向量化、相似度搜索

- **技术特点**：
  - 工具自动发现和注册机制
  - 参数验证和类型检查
  - 统一的错误处理格式

### 4. RAG 检索增强生成 (Retrieval-Augmented Generation)

**技术栈**：DashScope Embeddings + Milvus Lite + 文档检索

- **知识库构建**：
  - 支持 Markdown、TXT 等格式文档
  - 自动文档分块（Chunking）
  - 向量化存储到 Milvus Lite

- **检索流程**：
  1. 用户查询向量化（DashScope Embeddings）
  2. 向量相似度搜索（Milvus Lite）
  3. 检索相关文档片段
  4. LLM 基于检索结果生成回答

- **技术亮点**：
  - 使用 Milvus Lite（无需 Docker，本地部署）
  - 支持余弦相似度搜索
  - 可配置的相似度阈值和返回数量
  - 持久化存储，避免重复向量化

### 5. 数据持久化

**数据库支持**：SQLite（开发环境）+ MySQL（生产环境）

- **订单数据管理**：
  - 订单创建、查询、更新、删除
  - 支持多条件查询和筛选
  - 事务支持，确保数据一致性

- **向量数据管理**：
  - Milvus Lite 本地文件存储
  - 支持集合（Collection）管理
  - 自动 ID 生成和索引

### 6. 服务发现机制

**实现方式**：基于配置文件的轻量级服务发现

- 支持静态配置（`services.json`）
- 支持动态服务注册（可扩展 Redis 实现）
- 服务健康检查机制

---

## 技术亮点

### 1. 架构设计

- **模块化设计**：每个智能体独立部署，松耦合
- **协议标准化**：A2A 和 MCP 协议，便于扩展和维护
- **服务化架构**：每个组件都是独立的 HTTP 服务

### 2. LLM 应用

- **Prompt Engineering**：精心设计的系统提示词
- **工具调用决策**：使用 LLM 判断是否需要调用工具
- **参数提取**：从自然语言中提取结构化参数
- **响应生成**：将工具结果转换为友好的用户回复

### 3. 向量数据库集成

- **Milvus Lite**：轻量级向量数据库，无需 Docker
- **性能优化**：本地存储，毫秒级查询
- **可扩展性**：支持升级到 Milvus 集群

### 4. 错误处理和容错

- 完整的异常捕获和处理
- 服务不可用时的降级策略
- 详细的日志记录和调试信息

---

## 业务场景

### 场景 1：用户下单

```
用户: "我要一杯云边茉莉，少糖，正常冰"
  ↓
SupervisorAgent 识别为订单请求 → 路由到 OrderAgent
  ↓
OrderAgent 使用 LLM 提取参数 → 调用 MCP 工具创建订单
  ↓
OrderMCPServer 写入数据库 → 返回订单信息
  ↓
OrderAgent 生成友好回复 → 返回给用户
```

### 场景 2：产品咨询

```
用户: "云边茉莉的特点是什么？"
  ↓
SupervisorAgent 识别为咨询请求 → 路由到 ConsultAgent
  ↓
ConsultAgent 使用 RAG 检索知识库 → 找到相关文档
  ↓
ConsultAgent 基于检索结果生成回答 → 返回给用户
```

### 场景 3：订单查询

```
用户: "我想查询我的历史订单"
  ↓
SupervisorAgent 识别为订单请求 → 路由到 OrderAgent
  ↓
OrderAgent 提取 user_id → 调用 MCP 工具查询订单
  ↓
OrderMCPServer 查询数据库 → 返回订单列表
  ↓
OrderAgent 格式化结果 → 返回给用户
```

---

## 技术栈详解

### 核心框架
- **Python 3.8+**: 主要开发语言
- **DashScope SDK**: 阿里云通义千问 LLM API
- **Flask**: HTTP 服务框架（A2A 和 MCP 服务器）

### 数据库
- **SQLite**: 轻量级关系数据库（开发环境）
- **MySQL**: 生产级关系数据库（可选）
- **Milvus Lite**: 向量数据库（RAG 存储）

### 依赖管理
- **requirements.txt**: Python 依赖管理
- **.env**: 环境变量配置（API Key、数据库连接等）

### 工具库
- **requests**: HTTP 客户端
- **pymilvus**: Milvus 向量数据库客户端
- **pymysql**: MySQL 数据库客户端
- **numpy**: 数值计算（向量相似度）

---

## 项目结构

```
cloud-edge-milk-tea-agent/
├── supervisor_agent/          # 监督者智能体
├── order_agent/              # 订单智能体
├── consult_agent/            # 咨询智能体
├── order_mcp_server/         # 订单工具服务器
├── consult_mcp_server/       # 咨询工具服务器
├── a2a/                      # A2A 协议实现
├── mcp/                      # MCP 协议实现
├── rag/                      # RAG 检索增强生成
├── database/                 # 数据库管理
├── knowledge_base/           # 知识库文档
└── chat.py                   # 主入口（Terminal 交互）
```

---

## 核心能力总结

### 1. 多智能体协同
- ✅ Supervisor 模式架构
- ✅ 智能路由和负载均衡
- ✅ 服务发现和健康检查

### 2. 协议设计
- ✅ A2A 协议（Agent-to-Agent）
- ✅ MCP 协议（Model Context Protocol）
- ✅ 标准化接口设计

### 3. RAG 检索增强
- ✅ 知识库构建和管理
- ✅ 向量化存储和检索
- ✅ 相似度搜索和排序

### 4. 数据持久化
- ✅ 关系数据库（订单数据）
- ✅ 向量数据库（知识库）
- ✅ 事务支持和数据一致性

### 5. LLM 应用
- ✅ Prompt Engineering
- ✅ 工具调用决策
- ✅ 参数提取和验证
- ✅ 响应生成和格式化

---

## 面试要点

### 1. 架构设计能力
- **多智能体系统设计**：如何设计 Supervisor 模式，如何实现智能体间的通信
- **协议设计**：A2A 和 MCP 协议的设计思路，为什么选择 HTTP RESTful
- **服务化架构**：如何实现服务的独立部署和扩展

### 2. LLM 应用能力
- **Prompt Engineering**：如何设计系统提示词，如何让 LLM 准确判断工具调用
- **工具调用**：如何实现 LLM 的工具调用决策，如何处理参数提取
- **RAG 实现**：如何构建知识库，如何实现向量检索

### 3. 工程能力
- **数据库设计**：订单表结构设计，向量数据库的使用
- **错误处理**：异常处理机制，服务降级策略
- **代码组织**：模块化设计，代码可维护性

### 4. 业务理解
- **业务场景**：理解电商/餐饮场景的订单流程
- **用户体验**：如何设计友好的交互流程
- **数据安全**：用户数据隔离，订单数据一致性

---

## 项目亮点（面试时重点强调）

1. **完整的多智能体系统**：从架构设计到协议实现，展现了系统设计能力
2. **RAG 检索增强生成**：结合向量数据库，实现知识库问答
3. **标准化协议设计**：A2A 和 MCP 协议，便于扩展和维护
4. **生产级代码质量**：完整的错误处理、日志记录、服务发现
5. **业务场景完整**：覆盖订单、咨询、反馈等完整业务流程

---

## 可能的面试问题

### 1. 为什么选择 Supervisor 模式而不是其他模式？
**回答要点**：
- Supervisor 模式适合集中式协调场景
- 便于统一管理和监控
- 可以轻松扩展新的子智能体

### 2. A2A 协议和 MCP 协议的区别是什么？
**回答要点**：
- A2A：智能体之间的通信协议
- MCP：智能体与业务工具之间的协议
- 分层设计，职责清晰

### 3. 如何保证订单数据的一致性？
**回答要点**：
- 数据库事务支持
- 订单创建后的验证机制
- 错误回滚策略

### 4. RAG 检索的准确性如何保证？
**回答要点**：
- 相似度阈值设置
- 文档分块策略
- 检索结果排序和筛选

### 5. 如何扩展新的智能体？
**回答要点**：
- 实现 A2A Server 接口
- 注册到服务发现
- 在 SupervisorAgent 中添加路由规则

---

## 项目演示建议

1. **启动所有服务**：展示多服务协同工作
2. **下单流程**：演示完整的订单创建流程
3. **咨询流程**：演示 RAG 检索增强生成
4. **代码讲解**：重点讲解架构设计和协议实现

---

## 总结

这是一个**企业级的多智能体 AI 应用系统**，展现了：
- 系统架构设计能力
- LLM 应用开发能力
- 协议设计和实现能力
- 数据库和向量数据库使用能力
- 工程实践和代码质量

适合作为**AI 应用开发、多智能体系统、RAG 检索增强生成**等方向的面试项目。

