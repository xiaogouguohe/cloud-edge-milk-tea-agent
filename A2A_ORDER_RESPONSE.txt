================================================================================
OrderAgent 到 SupervisorAgent 的完整响应报文
场景：用户下单后的完整流程
================================================================================

【完整流程】

用户: "我要下单，一杯云边茉莉，少糖，正常冰"
  ↓
SupervisorAgent 路由到 OrderAgent
  ↓
SupervisorAgent 发送 A2A 请求到 OrderAgent
  ↓
OrderAgent 处理请求，调用 MCP 工具创建订单
  ↓
OrderAgent 返回 A2A 响应给 SupervisorAgent
  ↓
SupervisorAgent 提取响应，返回给用户

================================================================================

【1. SupervisorAgent 发送给 OrderAgent 的请求】

POST http://localhost:10006/a2a/invoke HTTP/1.1
Host: localhost:10006
Content-Type: application/json

{
    "input": "我要下单，一杯云边茉莉，少糖，正常冰",
    "chat_id": "chat_123456",
    "user_id": "user_789012"
}

================================================================================

【2. OrderAgent 处理流程】

2.1 OrderAgent 接收 A2A 请求
2.2 调用 chat() 方法处理用户输入
2.3 使用 LLM 判断需要调用 order-create-order-with-user 工具
2.4 调用 MCP Server 创建订单
2.5 接收 MCP Server 的响应
2.6 使用 LLM 整合结果，生成友好回复
2.7 返回给 A2A Server

================================================================================

【3. OrderAgent 返回给 SupervisorAgent 的响应】

HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 512

{
    "output": "好的，我已经为您创建了订单！\n\n订单详情：\n- 订单ID: ORDER_1693654321000\n- 产品: 云边茉莉\n- 甜度: 少糖\n- 冰量: 正常冰\n- 数量: 1\n- 总价: ¥18.00\n\n订单已成功创建，感谢您的订购！",
    "status": "success"
}

注意：output 字段的内容是 OrderAgent 的 chat() 方法返回的字符串，
该字符串是 OrderAgent 使用 LLM 将工具调用结果转换为的友好回复。

================================================================================

【响应格式说明】

1. 成功响应:
   - status: "success"
   - output: OrderAgent 生成的友好回复（字符串）

2. 错误响应:
   - status: "error"
   - error: 错误信息（字符串）

3. HTTP 状态码:
   - 成功: 200 OK
   - 错误: 500 Internal Server Error

================================================================================

【完整的响应报文（格式化）】

HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 512

{
    "output": "好的，我已经为您创建了订单！\n\n订单详情：\n- 订单ID: ORDER_1693654321000\n- 产品: 云边茉莉\n- 甜度: 少糖\n- 冰量: 正常冰\n- 数量: 1\n- 总价: ¥18.00\n\n订单已成功创建，感谢您的订购！",
    "status": "success"
}

================================================================================

【错误响应示例】

HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 256

{
    "output": "抱歉，创建订单时出现了问题：产品不存在，请检查产品名称是否正确。",
    "status": "success"
}

注意：即使工具调用失败，A2A Server 也会返回 status: "success"，
但 output 字段会包含错误信息。

================================================================================

【关键点说明】

1. OrderAgent 的 chat() 方法会：
   - 调用 MCP 工具获取订单创建结果
   - 使用 LLM 将工具结果转换为友好的用户回复
   - 返回格式化的字符串

2. A2A Server 会将 chat() 的返回值包装在 output 字段中

3. SupervisorAgent 会提取 output 字段的内容返回给用户

================================================================================

【实际响应内容示例（根据代码逻辑）】

如果 MCP Server 返回：
{
    "status": "success",
    "result": "订单创建成功！\n订单ID: ORDER_1693654321000\n..."
}

OrderAgent 的 chat() 方法会：
1. 接收工具结果
2. 使用 LLM 生成友好回复
3. 返回类似这样的内容：

"好的，我已经为您创建了订单！

订单详情：
- 订单ID: ORDER_1693654321000
- 产品: 云边茉莉
- 甜度: 少糖
- 冰量: 正常冰
- 数量: 1
- 总价: ¥18.00

订单已成功创建，感谢您的订购！"

然后 A2A Server 会包装成：
{
    "output": "好的，我已经为您创建了订单！\n\n订单详情：\n- 订单ID: ORDER_1693654321000\n- 产品: 云边茉莉\n- 甜度: 少糖\n- 冰量: 正常冰\n- 数量: 1\n- 总价: ¥18.00\n\n订单已成功创建，感谢您的订购！",
    "status": "success"
}

================================================================================

